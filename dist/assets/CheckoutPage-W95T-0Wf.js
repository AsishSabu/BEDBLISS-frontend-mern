import{u as $,r as w,s as V,j as e,U as F}from"./index-C0JB0cT-.js";import{F as X,a as Y,b,E as k}from"./formik.esm-DlztVDdY.js";import{c as H,a as g}from"./index.esm-BKJcP99K.js";import{a as Z}from"./hoist-non-react-statics.cjs-CxxjioJb.js";import{u as J}from"./Notifications-BtANmxaB.js";import"./index-Cd8CbeYN.js";import"./clsx-B-dksMZM.js";var R="https://js.stripe.com/v3",Q=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,L="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",ee=function(){for(var o=document.querySelectorAll('script[src^="'.concat(R,'"]')),t=0;t<o.length;t++){var n=o[t];if(Q.test(n.src))return n}return null},A=function(o){var t="",n=document.createElement("script");n.src="".concat(R).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},re=function(o,t){!o||!o._registerWrapper||o._registerWrapper({name:"stripe-js",version:"3.4.0",startTime:t})},y=null,S=null,P=null,oe=function(o){return function(){o(new Error("Failed to load Stripe.js"))}},ae=function(o,t){return function(){window.Stripe?o(window.Stripe):t(new Error("Stripe.js not available"))}},te=function(o){return y!==null?y:(y=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&o&&console.warn(L),window.Stripe){t(window.Stripe);return}try{var a=ee();if(a&&o)console.warn(L);else if(!a)a=A(o);else if(a&&P!==null&&S!==null){var d;a.removeEventListener("load",P),a.removeEventListener("error",S),(d=a.parentNode)===null||d===void 0||d.removeChild(a),a=A(o)}P=ae(t,n),S=oe(n),a.addEventListener("load",P),a.addEventListener("error",S)}catch(p){n(p);return}}),y.catch(function(t){return y=null,Promise.reject(t)}))},ne=function(o,t,n){if(o===null)return null;var a=o.apply(void 0,t);return re(a,n),a},j,W=!1,M=function(){return j||(j=te(null).catch(function(o){return j=null,Promise.reject(o)}),j)};Promise.resolve().then(function(){return M()}).catch(function(c){W||console.warn(c)});var se=function(){for(var o=arguments.length,t=new Array(o),n=0;n<o;n++)t[n]=arguments[n];W=!0;var a=Date.now();return M().then(function(d){return ne(d,t,a)})};const O=c=>new Date(c).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),ce=H().shape({firstName:g().required("Please fill in your first name"),lastName:g().required("Please fill in your last name"),email:g().email("Invalid email address").required("Please fill in your email address"),country:g().required("Please select your country/region"),phone:g().required("Please fill in your phone number")}),he=()=>{const c=$(),[o,t]=w.useState(null),[n,a]=w.useState(null),[d,p]=w.useState("Online"),r=V(s=>s.bookingSlice);console.log(r,"bookingData...........");const{data:v}=J(F+"/profile");w.useEffect(()=>{v&&(console.log(v.user.wallet,"wallet"),t(v.user.wallet))},[v]);const q=new Date(r.checkIn),G=new Date(r.checkOut),I=Math.ceil((G-q)/(1e3*60*60*24));console.log(I,"days"),console.log(r.rooms);const f=I*r.rooms.reduce((s,l)=>s+l.rooms.length*l.roomDetails.price,0);console.log(f,"total price");const E=new Date(Date.now());console.log(E,"today");let u=0;if(r.offer){const s=new Date(r.offer.startDate),l=new Date(r.offer.endDate);E>=s&&E<=l&&(console.log(r.offer,"offer"),r.offer.type==="flat"?f>=r.offer.minAmount&&f<=r.offer.maxAmount&&(console.log(r.offer.type,r.offer.amount),u=r.offer.amount):(console.log(r.offer.type,r.offer.amount),u=f*(r.offer.amount/100)))}console.log(u,"discount applied"),console.log(f,"total price after discount");const _=f*.05;console.log(_,"platform fee");const N=_+f-u;console.log(N,"final amount to pay");const T=O(r.checkIn),U=O(r.checkOut),B=r.adults+r.children,D=s=>{if(console.log(s,"argument"),s==="Wallet"){if(N>((o==null?void 0:o.balance)??0))return a("Insufficient balance");a(null),console.log("wallet"),p("Wallet")}s==="Online"&&(a(null),p("Online")),s==="pay_on_checkout"&&(a(null),p("pay_on_checkout")),console.log(d,"method")},z=async s=>{try{if(n!==null)return;console.log(r.rooms);const l=r.rooms.map(i=>{var m;return{roomId:(m=i.roomDetails)==null?void 0:m._id,roomNumbers:i.rooms.map(K=>K.number)}}),h={firstName:s.firstName,lastName:s.lastName,email:s.email,phoneNumber:s.phone,hotelId:r.hotelId,checkInDate:r.checkIn,checkOutDate:r.checkOut,maxAdults:r.adults,maxChildren:r.children,rooms:l,price:N,platformFee:_,totalDays:r.totalDays,paymentMethod:d};console.log(h);const x=await Z.post(`${F}/bookNow`,h,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});console.log(x);const C=x.data.id;if(C){console.log("with stripe");const i=await se("pk_test_51PNFlrP2IX2bYbhfGGl8kjEabKLgTan0A27MkB62etqKijMgeWef814LqKoDfLky7sWaGc1V9byH5fFbG4zgZdFq00MFi6bTEs");console.log(i);const m=await(i==null?void 0:i.redirectToCheckout({sessionId:C}));m!=null&&m.error&&console.error(m.error)}else{console.log("without stripope");const i=x.data.booking.bookingId;c(`/user/payment_status/${i}?success=true`)}}catch(l){console.log("Error in creating order",l)}};return e.jsx(X,{initialValues:{firstName:"",lastName:"",email:"",country:"India",phone:""},validationSchema:ce,onSubmit:z,children:({})=>e.jsx(Y,{className:"container mx-auto p-4",children:e.jsxs("div",{className:"border p-4 rounded shadow-lg  grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:r.name}),e.jsxs("p",{children:[r.city,", ",r.district,","," ",r.pincode,", ",r.country]}),e.jsx("p",{className:"text-green-600",children:"Great location — 8.8"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("span",{className:"text-blue-500 font-bold",children:"9.4"}),e.jsx("span",{children:"Superb - 579 reviews"})]})]}),e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your booking details"}),e.jsxs("p",{children:["Check-in: ",e.jsx("strong",{children:T})]}),e.jsxs("p",{children:["Check-out: ",e.jsx("strong",{children:U})]}),e.jsx("p",{}),e.jsxs("p",{children:["No of Guests: ",e.jsxs("strong",{children:[B," guests"]})]}),e.jsx("div",{onClick:()=>c(-1),className:"text-blue-500 underline cursor-pointer",children:"Change your selection"})]}),e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your price summary"}),e.jsxs("p",{children:["Total Hotel Amount: ",e.jsxs("strong",{children:["₹ ",f]})]}),e.jsxs("p",{children:["platform fee: ",e.jsxs("strong",{children:["₹ ",_]})]}),u!==0&&e.jsxs("p",{children:["Discount price: ",e.jsxs("strong",{children:["-₹",u]})]}),e.jsxs("p",{children:["Total Amount: ",e.jsxs("strong",{children:["₹ ",N]})]})]}),e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Wallet"}),e.jsxs("p",{children:["Balance : ",e.jsxs("strong",{children:["₹ ",o==null?void 0:o.balance]})]})]}),e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Payment"}),e.jsxs("div",{className:"p-2",children:[e.jsx("label",{htmlFor:"inlineRadio1",className:"block mb-2 text-sm font-semibold text-gray-900 dark:text-white",children:"Payment Method"}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"mb-[0.125rem] mr-4 inline-block min-h-[1.5rem] pl-[1.5rem]",children:[e.jsx("input",{className:"relative float-left -ml-[1.5rem] mr-1 mt-0.5 h-5 w-5 appearance-none rounded-full border-2 border-solid border-neutral-300 before:pointer-events-none before:absolute before:h-4 before:w-4 before:scale-0 before:rounded-full before:bg-transparent before:opacity-0 before:shadow-[0px_0px_0px_13px_transparent] before:content-[''] after:absolute after:z-[1] after:block after:h-4 after:w-4 after:rounded-full after:content-[''] checked:border-primary checked:before:opacity-[0.16] checked:after:absolute checked:after:left-1/2 checked:after:top-1/2 checked:after:h-[0.625rem] checked:after:w-[0.625rem] checked:after:rounded-full checked:after:border-primary checked:after:bg-primary checked:after:content-[''] checked:after:[transform:translate(-50%,-50%)] hover:cursor-pointer hover:before:opacity-[0.04] hover:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:shadow-none focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] checked:focus:border-primary checked:focus:before:scale-100 checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s] dark:border-neutral-600 dark:checked:border-primary dark:checked:after:border-primary dark:checked:after:bg-primary dark:focus:before:shadow-[0px_0px_0px_13px_rgba(255,255,255,0.4)] dark:checked:focus:border-primary dark:checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca]",type:"radio",name:"paymentMethod",id:"inlineRadio2",value:"Online",defaultChecked:!0,onChange:()=>D("Online")}),e.jsx("label",{className:"mt-px inline-block pl-[0.15rem] hover:cursor-pointer",htmlFor:"inlineRadio2",children:"Online"})]}),e.jsxs("div",{className:"mb-[0.125rem] mr-4 min-h-[1.5rem] pl-[1.5rem] flex items-center",children:[e.jsx("input",{className:"relative float-left -ml-[1.5rem] mr-1 mt-0.5 h-5 w-5 appearance-none rounded-full border-2 border-solid border-neutral-300 before:pointer-events-none before:absolute before:h-4 before:w-4 before:scale-0 before:rounded-full before:bg-transparent before:opacity-0 before:shadow-[0px_0px_0px_13px_transparent] before:content-[''] after:absolute after:z-[1] after:block after:h-4 after:w-4 after:rounded-full after:content-[''] checked:border-primary checked:before:opacity-[0.16] checked:after:absolute checked:after:left-1/2 checked:after:top-1/2 checked:after:h-[0.625rem] checked:after:w-[0.625rem] checked:after:rounded-full checked:after:border-primary checked:after:bg-primary checked:after:content-[''] checked:after:[transform:translate(-50%,-50%)] hover:cursor-pointer hover:before:opacity-[0.04] hover:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:shadow-none focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] checked:focus:border-primary checked:focus:before:scale-100 checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s] dark:border-neutral-600 dark:checked:border-primary dark:checked:after:border-primary dark:checked:after:bg-primary dark:focus:before:shadow-[0px_0px_0px_13px_rgba(255,255,255,0.4)] dark:checked:focus:border-primary dark:checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca]",type:"radio",name:"paymentMethod",id:"inlineRadio1",value:"Wallet",onChange:()=>D("Wallet")}),e.jsx("label",{className:"mt-px inline-block pl-[0.15rem] hover:cursor-pointer",htmlFor:"inlineRadio1",children:"Wallet"})]}),e.jsxs("div",{className:"mb-[0.125rem] mr-4 min-h-[1.5rem] pl-[1.5rem] flex items-center",children:[e.jsx("input",{className:"relative float-left -ml-[1.5rem] mr-1 mt-0.5 h-5 w-5 appearance-none rounded-full border-2 border-solid border-neutral-300 before:pointer-events-none before:absolute before:h-4 before:w-4 before:scale-0 before:rounded-full before:bg-transparent before:opacity-0 before:shadow-[0px_0px_0px_13px_transparent] before:content-[''] after:absolute after:z-[1] after:block after:h-4 after:w-4 after:rounded-full after:content-[''] checked:border-primary checked:before:opacity-[0.16] checked:after:absolute checked:after:left-1/2 checked:after:top-1/2 checked:after:h-[0.625rem] checked:after:w-[0.625rem] checked:after:rounded-full checked:after:border-primary checked:after:bg-primary checked:after:content-[''] checked:after:[transform:translate(-50%,-50%)] hover:cursor-pointer hover:before:opacity-[0.04] hover:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:shadow-none focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[0px_0px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] checked:focus:border-primary checked:focus:before:scale-100 checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s] dark:border-neutral-600 dark:checked:border-primary dark:checked:after:border-primary dark:checked:after:bg-primary dark:focus:before:shadow-[0px_0px_0px_13px_rgba(255,255,255,0.4)] dark:checked:focus:border-primary dark:checked:focus:before:shadow-[0px_0px_0px_13px_#3b71ca]",type:"radio",name:"paymentMethod",id:"inlineRadio1",value:"pay_on_checkout",onChange:()=>D("pay_on_checkout")}),e.jsx("label",{className:"mt-px inline-block pl-[0.15rem] hover:cursor-pointer",htmlFor:"inlineRadio1",children:"Pay At CheckOut"})]}),n&&e.jsx("p",{className:"text-red-500 ml-2",children:n}),e.jsx("div",{className:"text-right",children:e.jsx("button",{type:"submit",className:"bg-blue-500 text-white py-2 px-4 rounded",children:"Book Now"})})]})]})]})]}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"border p-4 rounded mb-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Enter your details"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"firstName",className:"mb-1",children:"Please fill in your first name"}),e.jsx(b,{type:"text",id:"firstName",name:"firstName",className:"border p-2 rounded focus:outline-none focus:border-blue-500"}),e.jsx(k,{name:"firstName",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"lastName",className:"mb-1",children:"Please fill in your last name"}),e.jsx(b,{type:"text",id:"lastName",name:"lastName",className:"border p-2 rounded focus:outline-none focus:border-blue-500"}),e.jsx(k,{name:"lastName",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"email",className:"mb-1",children:"Please fill in your email address"}),e.jsx(b,{type:"email",id:"email",name:"email",className:"border p-2 rounded focus:outline-none focus:border-blue-500",placeholder:""}),e.jsx(k,{name:"email",component:"div",className:"text-red-500 text-sm"}),e.jsx("span",{className:"text-gray-500 text-xs"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"country",className:"mb-1",children:"Country/region"}),e.jsxs(b,{as:"select",id:"country",name:"country",className:"border p-2 rounded focus:outline-none focus:border-blue-500",children:[e.jsx("option",{value:"India",children:"India"}),e.jsx("option",{value:"United States",children:"United States"}),e.jsx("option",{value:"United Kingdom",children:"United Kingdom"}),e.jsx("option",{value:"Australia",children:"Australia"}),e.jsx("option",{value:"Canada",children:"Canada"})]}),e.jsx(k,{name:"country",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"phone",className:"mb-1",children:"Please fill in your phone number"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"border p-2 rounded-l bg-gray-100",children:"+91"}),e.jsx(b,{type:"tel",id:"phone",name:"phone",className:"border p-2 rounded-r flex-grow focus:outline-none focus:border-blue-500"})]}),e.jsx(k,{name:"phone",component:"div",className:"text-red-500 text-sm"}),e.jsx("span",{className:"p-5 text-center  text-xs text-red-800 font-bold",children:"Read the cancellation policy before booking"})]}),e.jsxs("div",{className:"border border-spacing-2 rounded-lg",children:[e.jsx("span",{className:"text-gray-700 text-sm font-bold flex justify-center",children:"Cancellation Policy"}),r.cancellationPolicies&&(r==null?void 0:r.cancellationPolicies.map((s,l)=>e.jsxs("div",{className:"p-1",children:[e.jsx("div",{className:"text-sm ",children:s.name}),e.jsx("ul",{children:Object.entries(s.terms).map(([h,x])=>e.jsxs("li",{className:"text-gray-500 text-xs",children:[e.jsxs("div",{className:"text-varGreen",children:[h,":"]})," ",x]},h))})]},l)))]})]})]})})]})})})};export{he as default};
